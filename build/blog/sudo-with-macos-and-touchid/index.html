<!DOCTYPE html>
<html lang="fr-FR" prefix="og: http://ogp.me/ns#" >
    <head>

        <title>
            bruno-giarrizzo.fr
        </title>

            <meta charset="utf-8">
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="alternate" type="application/rss+xml" title="Bruno Giarrizzo - Blog RSS" href="https://www.bruno-giarrizzo.fr/blog/feed.xml" />
    <meta name="rating" content="General" />
    <meta name="Author" content="Bruno Giarrizzo" />
    <meta name="Webmaster" content="Bruno Giarrizzo" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="Language" content="en" />
    <meta http-equiv="content-language" content="en" />
    <meta name="robots" content="all" />
    <meta name="revisit-after" content="1 days" />
    <meta name="expires" content="never" />

    <!-- SEO -->
    <meta name="robots" content="index, follow" />
    <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
    <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
    <meta name="identifier-URL" content="https://www.bruno-giarrizzo.fr" />
 
    <!-- Meta -->
    
        <title>Sudo with macos and TouchID</title>
        <meta name="title" content="Sudo with macos and TouchID - Bruno Giarrizzo" />
        <link rel="canonical" href="https://www.bruno-giarrizzo.fr/blog/sudo-with-macos-and-touchid/" />
        <meta name="keywords" content="Bruno, Giarrizzo, Bruno Giarrizzo, Freelance, Developer, DevOps, Ethical Hacker, Ethical, Hacker, Django, Python, Swift, Ansible, Terraform, Kubernetes, Infra as Code, macos, sudo, terminal, touch, id, touchid" />
        <meta name="description" content="I am a lazy guy, and type my password kind of annoy me :-D" />
    
        
    </head>

    <body>

        <nav>
    <a href="/">Home</a>
    <a href="/blog/">Blog</a>
    <a href="/resume/">Resume</a>
    <a href="/about/">About</a>
</nav>

        <main>
            
            <header>
  <img width="100%" src="/media/images/posts/covers/2022-08-03.jpg" alt="Sudo with macos and TouchID article cover">
  <h1>Sudo with macos and TouchID</h1>
  <p class="subtitle">by <a href="">Bruno</a>, on 03-Aug-2022</p>
  
    <p class="summary">I am a lazy guy, and type my password kind of annoy me :-D</p>
  
</header>

<hr />

<article>
  <p>Last October, i got for myself one M1 Macbook pro.</p>
<p>It is a hell of a machine, powerful, silent and it comes with touchID. </p>
<p>I didn't change my laptop since my mid-2012 macbook pro, and this was a revolution !</p>
<p>I saw one day, one of my coworker edit files with <code>sudo vi</code>, no password typed, just put his finger on touchID pad, I always wanted to do the same, so i configured it.</p>
<p>By default, it is not configured on macos, you have to edit one file : <code>/etc/pam.d/sudo</code></p>
<p>In this file, you'll find this content : </p>
<pre>
    # sudo: auth account password session
    auth       sufficient     pam_smartcard.so
    auth       required       pam_opendirectory.so
    account    required       pam_permit.so
    password   required       pam_deny.so
    session    required       pam_permit.so
</pre>

<p>I just add the line : <code>auth sufficient pam_tid.so</code> so the file looks like this then :</p>
<pre>
    # sudo: auth account password session
    auth       sufficient     pam_tid.so
    auth       sufficient     pam_smartcard.so
    auth       required       pam_opendirectory.so
    account    required       pam_permit.so
    password   required       pam_deny.so
    session    required       pam_permit.so
</pre>

<h1>Bonus</h1>
<p>On the day you update your mac, the <code>/etc/pam.d/sudo</code> may be overwritten by the update process. And your changes will be lost.</p>
<p>(I know it is one line to add to file, but if you are lazy like me, you will understand :D)</p>
<p>One github user, named <a href="https://github.com/tjluoma">tjluoma</a> made a little script, named <a href="https://github.com/tjluoma/sudo-via-touch-id">tjluoma/sudo-via-touch-id</a>, that will check if the line is present in your <code>/etc/pam.d/sudo</code>, and will add it if not !</p>
<p>Just like he indicates it on his README : </p>
<pre>
## How to use this

1. Download sudo-via-touch-id.sh
2. Make it executable: `chmod 755 sudo-via-touch-id.sh`
3. Run it: `./sudo-via-touch-id.sh`
4. (Optional But Useful) move it to a directory such as `/usr/local/bin/` 
so you can run it again next time there's an update to macOS.
</pre>

<p>After i installed this script in my <code>/usr/local/bin/</code>, i edited my crontab to run the script each time my laptop is rebooted.</p>
<p>Like this : </p>
<pre>
    @reboot    bash /usr/local/bin/sudo-via-touch-id.sh
</pre>

<p>With this, on each reboot the script will run, and add the missing line to the <code>/etc/pam.d/sudo</code> if update deleted it !</p>
</article>
        </main>
            
        <footer>
    <a href="https://www.bruno-giarrizzo.fr">https://www.bruno-giarrizzo.fr</a>
</footer>
        <!-- Favicon -->
<link href="/static/img/logo.jpg" rel="icon" type="image/jpg" />

<!-- Main CSS -->
<link rel="stylesheet" href="/static/css/main.css" />
        
    </body>

</html>